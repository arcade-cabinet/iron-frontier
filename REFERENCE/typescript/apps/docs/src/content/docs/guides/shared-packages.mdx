---
title: Shared Packages
description: Understanding the shared packages in Iron Frontier's monorepo
---

import { Aside, FileTree, Card, CardGrid } from '@astrojs/starlight/components';

Iron Frontier uses a monorepo with shared packages to maximize code reuse between web and mobile platforms.

## Package Overview

<CardGrid>
  <Card title="@iron-frontier/shared" icon="seti:typescript">
    Core game logic, data schemas, state management, and procedural generation.
  </Card>
  <Card title="@iron-frontier/ui" icon="seti:react">
    Cross-platform UI primitives and design tokens.
  </Card>
</CardGrid>

## @iron-frontier/shared

The shared package contains all platform-agnostic game code:

<FileTree>
- packages/shared/src/
  - data/
    - schemas/       # Zod schemas for validation
    - locations/     # Hand-crafted locations
    - worlds/        # World definitions
    - npcs/          # NPC data and dialogues
    - items/         # Item definitions
    - generation/    # Procedural generation
  - store/
    - createGameStore.ts
    - StorageAdapter.ts
    - types.ts
  - rendering/
    - interfaces.ts  # Rendering abstraction
    - adapters/      # Platform adapters
  - hex/
    - HexCoord.ts    # Hex grid utilities
    - HexECS.ts      # ECS components
  - types/
    - index.ts       # Shared type definitions
  - generation/
    - CharacterGenerator.ts
  - index.ts         # Package exports
</FileTree>

### Import Paths

The package provides multiple entry points to avoid naming conflicts:

```typescript
// Main entry (data + types + generation)
import { Player, Quest, NPC } from '@iron-frontier/shared';

// Specific modules
import { getLocation, getNPCsByLocation } from '@iron-frontier/shared/data';
import { createGameStore } from '@iron-frontier/shared/store';
import { HexCoord, HexGrid } from '@iron-frontier/shared/hex';
import { RenderingAdapter } from '@iron-frontier/shared/rendering';
```

<Aside type="tip">
  Use specific imports to avoid pulling in unnecessary code and potential naming conflicts.
</Aside>

### Data Schemas (Zod)

All game data is validated with Zod schemas:

```typescript
// packages/shared/src/data/schemas/npc.ts
import { z } from 'zod';

export const NPCSchema = z.object({
  id: z.string(),
  name: z.string(),
  role: z.enum(['merchant', 'quest_giver', 'guard', 'civilian']),
  faction: z.string().optional(),
  dialogueId: z.string().optional(),
  schedule: ScheduleSchema.optional(),
});

export type NPC = z.infer<typeof NPCSchema>;
```

Available schemas:

| Schema | Description |
|--------|-------------|
| `LocationSchema` | Location definitions |
| `NPCSchema` | NPC data structure |
| `QuestSchema` | Quest definitions |
| `ItemSchema` | Item properties |
| `CombatSchema` | Combat state |
| `GenerationSchema` | Procedural templates |

### Procedural Generation

The generation system creates dynamic content:

```typescript
import {
  generateNPC,
  generateQuest,
  generateEncounter
} from '@iron-frontier/shared/data';

// Generate a procedural NPC for a location
const npc = generateNPC({
  seed: worldSeed,
  locationId: 'dusty_springs',
  locationType: 'town',
  archetype: 'merchant',
});

// Generate a quest from a template
const quest = generateQuest({
  seed: worldSeed,
  template: 'bounty_hunt',
  giver: npc,
});
```

### State Management

The Zustand store is created through a factory:

```typescript
import { createGameStore, StorageAdapter } from '@iron-frontier/shared/store';

// Create platform-specific storage
const storage = new StorageAdapter({ ... });

// Create the store
const useGameStore = createGameStore(storage);

// Use in components
function PlayerHealth() {
  const health = useGameStore((s) => s.player.health);
  return <HealthBar value={health} />;
}
```

## @iron-frontier/ui

Shared UI components and design tokens:

<FileTree>
- packages/ui/src/
  - tokens/
    - colors.ts      # Color palette
    - spacing.ts     # Spacing scale
    - typography.ts  # Font definitions
    - shadows.ts     # Shadow styles
    - animation.ts   # Animation timings
  - primitives/
    - types.ts       # Shared prop types
    - utils.ts       # UI utilities
  - web/
    - Button.tsx     # Web button component
    - Card.tsx
    - Modal.tsx
  - native/
    - Button.tsx     # Native button component
    - Card.tsx
    - Modal.tsx
</FileTree>

### Design Tokens

Consistent design tokens across platforms:

```typescript
// packages/ui/src/tokens/colors.ts
export const colors = {
  // Brand colors (western theme)
  brass: {
    50: '#faf8f5',
    100: '#f5e6d3',
    500: '#c9956c',
    900: '#3d2c1a',
  },

  // Semantic colors
  primary: '#c9956c',    // Brass accent
  secondary: '#6b7280',  // Steel gray
  danger: '#dc2626',
  success: '#16a34a',

  // Background
  background: {
    primary: '#1a1816',
    secondary: '#302d28',
    tertiary: '#4d4840',
  },
};
```

### Cross-Platform Components

Components export platform-specific implementations:

```typescript
// Web usage
import { Button } from '@iron-frontier/ui/web';

// Native usage
import { Button } from '@iron-frontier/ui/native';

// Both have the same API
<Button variant="primary" onPress={handleClick}>
  Start Game
</Button>
```

## Package Configuration

### package.json (shared)

```json
{
  "name": "@iron-frontier/shared",
  "exports": {
    ".": "./src/index.ts",
    "./data": "./src/data/index.ts",
    "./types": "./src/types/index.ts",
    "./generation": "./src/generation/index.ts",
    "./hex": "./src/hex/index.ts",
    "./store": "./src/store/index.ts",
    "./rendering": "./src/rendering/index.ts"
  },
  "dependencies": {
    "zod": "^4.x",
    "zustand": "^5.x",
    "miniplex": "^2.x",
    "simplex-noise": "^4.x"
  }
}
```

### pnpm-workspace.yaml

```yaml
packages:
  - 'packages/*'
  - 'apps/*'
```

## Adding New Shared Code

When adding shared functionality:

1. **Determine the module**: data, store, rendering, hex, or types
2. **Add to the appropriate directory** under `packages/shared/src/`
3. **Export from the module index** (`index.ts`)
4. **Add Zod schema** if it's a data type
5. **Write tests** in the same directory or `__tests__/`

Example: Adding a new enemy type

```typescript
// 1. Define schema in packages/shared/src/data/schemas/enemy.ts
export const EnemySchema = z.object({
  id: z.string(),
  name: z.string(),
  level: z.number(),
  health: z.number(),
  attacks: z.array(AttackSchema),
});

// 2. Export from schemas/index.ts
export * from './enemy';

// 3. Create enemy data in packages/shared/src/data/enemies/
export const BANDIT: Enemy = {
  id: 'bandit',
  name: 'Bandit',
  level: 1,
  health: 30,
  attacks: [{ name: 'Pistol Shot', damage: 10 }],
};

// 4. Export from data/index.ts
export * from './enemies';
```

## Testing Shared Code

Tests live alongside the code:

```bash
# Run shared package tests
pnpm --filter @iron-frontier/shared test

# Watch mode
pnpm --filter @iron-frontier/shared test -- --watch
```

<Aside type="note">
  Shared code tests should not depend on DOM or platform-specific APIs.
</Aside>

## Next Steps

- [Architecture Overview](/iron-frontier/guides/architecture/) - System design
- [Rendering Abstraction](/iron-frontier/guides/rendering/) - Cross-platform 3D
- [API Reference](/iron-frontier/reference/api/) - Full API documentation
