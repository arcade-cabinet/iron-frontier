---
title: Data Schemas
description: Zod schemas for data validation in Iron Frontier
---

import { Aside } from '@astrojs/starlight/components';

Iron Frontier uses **Zod** for runtime data validation. All game data is validated against schemas to ensure type safety at runtime.

## Schema Organization

Schemas are organized by domain in `packages/shared/src/data/schemas/`:

| File | Content |
|------|---------|
| `spatial.ts` | Location, Region, Connection schemas |
| `npc.ts` | NPC, Dialogue, Schedule schemas |
| `item.ts` | Item, Equipment, Loot schemas |
| `quest.ts` | Quest, Objective, Reward schemas |
| `combat.ts` | Combat, Encounter, Enemy schemas |
| `generation.ts` | Procedural generation templates |
| `world.ts` | World, Region definitions |

## Location Schemas

### LocationSchema

```typescript
import { z } from 'zod';

export const LocationTypeSchema = z.enum([
  'town',
  'city',
  'mine',
  'ranch',
  'outpost',
  'camp',
  'ruin',
  'waystation',
]);

export const DangerLevelSchema = z.enum([
  'safe',
  'low',
  'moderate',
  'high',
  'extreme',
]);

export const LocationSchema = z.object({
  id: z.string(),
  name: z.string(),
  type: LocationTypeSchema,
  description: z.string(),
  region: z.string(),
  position: z.tuple([z.number(), z.number()]),
  size: z.tuple([z.number(), z.number()]).default([100, 100]),
  dangerLevel: DangerLevelSchema.default('safe'),
  biome: z.string().optional(),
  structures: z.array(StructureRefSchema).default([]),
  npcs: z.array(NPCRefSchema).default([]),
  items: z.array(ItemSpawnSchema).default([]),
  connections: z.array(ConnectionSchema).default([]),
});

export type Location = z.infer<typeof LocationSchema>;
```

### ConnectionSchema

```typescript
export const TravelMethodSchema = z.enum([
  'road',
  'trail',
  'railroad',
  'river',
  'none',
]);

export const ConnectionSchema = z.object({
  targetId: z.string(),
  travelMethod: TravelMethodSchema,
  distance: z.number(), // in game units
  dangerLevel: DangerLevelSchema.optional(),
});
```

## NPC Schemas

### NPCSchema

```typescript
export const NPCRoleSchema = z.enum([
  'merchant',
  'quest_giver',
  'guard',
  'civilian',
  'bartender',
  'sheriff',
  'outlaw',
  'doctor',
  'blacksmith',
]);

export const NPCSchema = z.object({
  id: z.string(),
  name: z.string(),
  role: NPCRoleSchema,
  title: z.string().optional(),
  faction: z.string().optional(),
  location: z.string(),
  position: z.tuple([z.number(), z.number(), z.number()]).default([0, 0, 0]),
  model: z.string().optional(),
  dialogueId: z.string().optional(),
  schedule: ScheduleSchema.optional(),
  shopId: z.string().optional(),
  personality: PersonalitySchema.optional(),
});

export type NPC = z.infer<typeof NPCSchema>;
```

### DialogueSchema

```typescript
export const DialogueNodeSchema = z.object({
  id: z.string(),
  text: z.string(),
  speaker: z.enum(['npc', 'player']),
  options: z.array(DialogueOptionSchema).default([]),
  conditions: z.array(DialogueConditionSchema).optional(),
  effects: z.array(DialogueEffectSchema).optional(),
});

export const DialogueOptionSchema = z.object({
  id: z.string(),
  text: z.string(),
  nextNodeId: z.string().optional(),
  conditions: z.array(DialogueConditionSchema).optional(),
  effects: z.array(DialogueEffectSchema).optional(),
});

export const DialogueTreeSchema = z.object({
  id: z.string(),
  npcId: z.string(),
  startNodeId: z.string(),
  nodes: z.record(DialogueNodeSchema),
});
```

## Item Schemas

### ItemSchema

```typescript
export const ItemTypeSchema = z.enum([
  'weapon',
  'armor',
  'consumable',
  'key',
  'material',
  'quest',
  'misc',
]);

export const RaritySchema = z.enum([
  'common',
  'uncommon',
  'rare',
  'epic',
  'legendary',
]);

export const ItemSchema = z.object({
  id: z.string(),
  name: z.string(),
  description: z.string(),
  type: ItemTypeSchema,
  rarity: RaritySchema.default('common'),
  value: z.number().default(0),
  weight: z.number().default(1),
  stackable: z.boolean().default(false),
  maxStack: z.number().default(1),
  icon: z.string().optional(),
  stats: ItemStatsSchema.optional(),
  effects: z.array(ItemEffectSchema).optional(),
  requirements: ItemRequirementsSchema.optional(),
});

export type Item = z.infer<typeof ItemSchema>;
```

### WeaponStatsSchema

```typescript
export const WeaponStatsSchema = z.object({
  damage: z.number(),
  damageType: z.enum(['physical', 'fire', 'electric', 'poison']),
  range: z.enum(['melee', 'short', 'medium', 'long']),
  accuracy: z.number().min(0).max(100),
  critChance: z.number().min(0).max(100).default(5),
  critMultiplier: z.number().default(1.5),
  attackSpeed: z.number().default(1),
  ammoType: z.string().optional(),
});
```

### ArmorStatsSchema

```typescript
export const ArmorStatsSchema = z.object({
  defense: z.number(),
  slot: z.enum(['head', 'body', 'hands', 'feet', 'accessory']),
  resistances: z.object({
    physical: z.number().default(0),
    fire: z.number().default(0),
    electric: z.number().default(0),
    poison: z.number().default(0),
  }).optional(),
});
```

## Quest Schemas

### QuestSchema

```typescript
export const QuestStatusSchema = z.enum([
  'available',
  'active',
  'completed',
  'failed',
]);

export const QuestSchema = z.object({
  id: z.string(),
  title: z.string(),
  description: z.string(),
  status: QuestStatusSchema.default('available'),
  giver: z.string(),
  location: z.string().optional(),
  level: z.number().default(1),
  objectives: z.array(QuestObjectiveSchema),
  rewards: QuestRewardsSchema,
  prerequisites: z.array(z.string()).default([]),
  timeLimit: z.number().optional(), // in game minutes
});

export const QuestObjectiveSchema = z.object({
  id: z.string(),
  type: z.enum(['kill', 'collect', 'talk', 'escort', 'explore', 'deliver']),
  description: z.string(),
  target: z.string(),
  required: z.number().default(1),
  current: z.number().default(0),
  completed: z.boolean().default(false),
  optional: z.boolean().default(false),
});
```

## Combat Schemas

### EncounterSchema

```typescript
export const EncounterSchema = z.object({
  id: z.string(),
  name: z.string(),
  enemies: z.array(EnemyInstanceSchema),
  terrain: z.string().optional(),
  ambush: z.boolean().default(false),
  escapeChance: z.number().min(0).max(100).default(50),
  rewards: EncounterRewardsSchema,
});

export const EnemyInstanceSchema = z.object({
  templateId: z.string(),
  level: z.number(),
  health: z.number(),
  maxHealth: z.number(),
  position: z.tuple([z.number(), z.number()]).optional(),
  modifiers: z.array(z.string()).default([]),
});
```

## Generation Schemas

### NPCTemplateSchema

```typescript
export const NPCTemplateSchema = z.object({
  id: z.string(),
  archetype: NPCRoleSchema,
  nameOrigins: z.array(z.string()),
  validLocationTypes: z.array(LocationTypeSchema),
  dialogueTemplates: z.array(z.string()),
  shopChance: z.number().min(0).max(1).default(0),
  shopTypes: z.array(z.string()).optional(),
  scheduleTemplate: z.string().optional(),
  personalityTraits: z.array(z.string()).optional(),
  factionWeights: z.record(z.number()).optional(),
});
```

### QuestTemplateSchema

```typescript
export const QuestTemplateSchema = z.object({
  id: z.string(),
  type: z.enum(['bounty', 'delivery', 'escort', 'investigation', 'fetch']),
  titleTemplates: z.array(z.string()),
  descriptionTemplates: z.array(z.string()),
  objectiveTemplates: z.array(ObjectiveTemplateSchema),
  rewardScaling: RewardScalingSchema,
  validGiverRoles: z.array(NPCRoleSchema),
  validLocations: z.array(LocationTypeSchema).optional(),
  minLevel: z.number().default(1),
  maxLevel: z.number().default(100),
});
```

## Using Schemas

### Validation

```typescript
import { LocationSchema } from '@iron-frontier/shared/data';

// Parse and validate data
const location = LocationSchema.parse(rawData);

// Safe parse (returns result object)
const result = LocationSchema.safeParse(rawData);
if (result.success) {
  console.log(result.data);
} else {
  console.error(result.error);
}
```

### Type Inference

```typescript
import { z } from 'zod';
import { LocationSchema } from '@iron-frontier/shared/data';

// Infer TypeScript type from schema
type Location = z.infer<typeof LocationSchema>;

// Use in functions
function processLocation(location: Location) {
  // Full type safety
  console.log(location.name, location.dangerLevel);
}
```

<Aside type="tip">
  Always use `safeParse` when handling external data (e.g., from saves or network) to gracefully handle validation errors.
</Aside>

## Next Steps

- [Procedural Generation](/iron-frontier/reference/procedural-generation/) - How templates are used
- [API Reference](/iron-frontier/reference/api/) - Full API documentation
