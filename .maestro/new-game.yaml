# New Game Flow Test - Iron Frontier
# Tests the complete flow of starting a new game
# Includes name input, game initialization, and reaching gameplay

appId: com.ironfrontier.mobile
name: "New Game Flow"
tags:
  - gameplay
  - new-game
  - critical

---

# Launch app with clean state to ensure fresh start
- launchApp:
    appId: com.ironfrontier.mobile
    clearState: true

# Wait for main menu
- extendedWaitUntil:
    visible: "Tales of the Steam Frontier"
    timeout: 15000

# Take screenshot of starting point
- takeScreenshot: screenshots/08_new_game_start

# Tap New Game / Begin Adventure button
- tapOn:
    text: ".*Adventure|.*New Game.*"
    regex: true

# Wait for name input field
- extendedWaitUntil:
    visible: "Enter your name, stranger..."
    timeout: 5000

# Input player name
- tapOn:
    text: "Enter your name, stranger..."

- inputText: "Dusty McCoy"

# Take screenshot with name entered
- takeScreenshot: screenshots/09_name_entered

# Tap Start button to begin game
- tapOn:
    text: "Start"

# Wait for game to initialize (WebGPU, world generation, etc.)
# This can take significant time on first load
- extendedWaitUntil:
    visible: "Loading Iron Frontier..."
    timeout: 5000
    optional: true

# Wait for game world to load
# The HUD should appear with player name
- extendedWaitUntil:
    visible: "Dusty McCoy"
    timeout: 30000

# Take screenshot of game loaded
- takeScreenshot: screenshots/10_game_loaded

# Verify game HUD elements are visible
# Health indicator should be present
- assertVisible:
    id: "game-hud"
    optional: true

# Verify action bar is visible at bottom
- assertVisible:
    text: ".*Outlaw|.*Territory|.*Saddlebag.*"
    regex: true

# Take screenshot of full gameplay screen
- takeScreenshot: screenshots/11_gameplay_screen

# Verify we're in the starting location (Dusty Springs)
- assertVisible:
    text: ".*Dusty Springs|.*Location.*"
    regex: true
    optional: true

# Test passes - new game started successfully
- runScript:
    script: |
      console.log('New game flow test completed successfully');
      output.newGameSuccess = true;
